\section{Appendix}

\allowdisplaybreaks

\subsection{Implementation}

The implementation of \superfluid can be found at \url{https://github.com/kontheocharis/superfluid}.

\subsection{Utilities when working with algebras} \label{app:algebras}

We define in an Agda-like syntax, the construction of displayed
algebras, sections and inductive algebras as telescopes in the object theory. We
also define realisation functions which convert an internal telescopic
construction into one which is partly lifted to the metatheory. Some implicit
arguments are omitted for brevity.

\subsubsection{Realisation functions for algebras}

\begin{fleqn}
\begin{align*}
&\emb{\_}^{\mta{alg}} : \Tms\ \Gamma\ (\mta{alg}\ T) \to \mta{Alg}\ T \\
&\emb{(X, a)}^{\mta{alg}} := (\mta{El}\ X@, \emb{a}^{\mta{algebra}}) \,. \\[1em]
&\emb{\_}^{\mta{algebra}} : \Tms\ \Gamma\ (\mta{algebra}\ T\ X) \to \mta{Algebra}\ T\ X \\
&\emb{\bullet}^{\mta{algebra}}\ \{T = \bullet\}\ (v, \_)\text{ impossible by $v : \mta{Var}\ \bullet$} \\
&\emb{(a', f)}^{\mta{algebra}}\ \{T = T' \rhd O\}\ (\mta{here}, d) := (f@)[\Msub{d}] \\
&\emb{(a', f)}^{\mta{algebra}}\ \{T = T' \rhd O\}\ (\mta{there}\ v, d) := \emb{a'}^{\mta{algebra}}\ (v, d) \,.
\end{align*}
\end{fleqn}

\subsubsection{Displayed algebras}

\begin{fleqn}
\begin{align*}
&\mta{dispIn} : (O : \mta{Op}\ \Gamma\ P) \to ((X, x) : \mta{Alg}\ T) \to \mta{Ty}\ (\Gamma \rhd P \rhd X) \to \Tel\ \Gamma \\
&\mta{dispIn}\ (\Pi\ A\ B)\ (X, x)\ M := \bullet \rhd (a : A) \rhd \mta{dispIn}\ B[\Msub a]\ (X, x)\ M \\
&\mta{dispIn}\ (\Pi\iota\ p\ B)\ (X, x)\ M := \bullet \rhd (y : X[\Msub p]) \rhd (m : M[\Msub{p, y}]) \rhd \mta{dispIn}\ B\ (X, x)\ M \\
&\mta{dispIn}\ (\iota\ p)\ (X, x)\ M := \bullet \,. \\[1em]
&\mta{dispInIn} : \Tms\ \Gamma\ (\mta{dispIn}\ O\ (X, x)\ M) \to \Tms\ \Gamma\ (\mta{in}\ O\ X) \\
&\mta{dispInIn}\ \{\Pi\ A\ B\}\ (a, t)\ M := (a, \mta{dispInIn}\ \{B[\Msub a]\}\ t\ M) \\
&\mta{dispInIn}\ \{\Pi\iota\ p\ B\}\ (y, m, t)\ M := (y,\mta{dispInIn}\ \{B\}\ t\ M) \\
&\mta{dispInIn}\ \{\iota\ p\}\ (\,)\ M := (\,) \,. \\[1em]
&\mta{dispOut} : \{O : \Op\ \Gamma\ P\} \to (i : \Tms\ \Gamma\ (\mta{dispIn}\ O\ (X, x)\ M)) \\
&\quad\to \Tms\ \Gamma\ X[\Msub{\mta{out}\ (\mta{dispInIn}\ i)\ X}]) \to \Tms\ \Gamma\ (P \rhd X) \\
&\mta{dispOut}\ \{\Pi\ A\ B\}\ (a, t)\ u := \mta{dispOut}\ \{B[\Msub a]\}\ t\ u \\
&\mta{dispOut}\ \{\Pi\iota\ p\ B\}\ (y, m, t)\ u := \mta{dispOut}\ \{B\}\ t\ u \\
&\mta{dispOut}\ \{\iota\ p\}\ x := (p, x) \,. \\[1em]
&\mta{dispOp} : \mta{Var}\ T \to ((X, x) : \mta{Alg}\ T) \to \mta{Ty}\ (\Gamma \rhd P \rhd X) \to \Ty\ \Gamma \\
&\mta{dispOp}\ v\ (X, x)\ M := \Pi\ (a : \mta{dispIn}\ (T\ v)\ (X, x)\ M)\ M[\Msub{\mta{dispOut}\ a\ (x\ (i, \mta{dispInIn}\ a))}]\, . \\[1em]
&\mta{dispAlgebra} : ((X, x) : \mta{Alg}\ T) \to \mta{Ty}\ (\Gamma \rhd P \rhd X) \to \Tel\ \Gamma \\
&\mta{dispAlgebra}\ \bullet\ X\ M := \bullet \\
&\mta{dispAlgebra}\ (T \rhd O)\ (X, x, y)\ M := \mta{dispAlgebra}\ T\ (X, x)\ M \rhd \mta{dispOp}\ (X, y)\ \mta{here}\ M \,. \\[1em]
&\mta{dispAlg} : \Tel\ (\Gamma \rhd \mta{alg}\ T) \\
&\mta{dispAlg} := X\ x.\ \bullet \rhd (M : \Pi\ P\ \Pi\ X\ \univ) \rhd \mta{dispAlgebra}\ \emb{(X, x)}^{\mta{algebra}}\ M \,.
\end{align*}
\end{fleqn}

\subsubsection{Realisation functions for displayed algebras}

\begin{fleqn}
\begin{align*}
&\emb{\_}^{\mta{dispAlg}} : \Tms\ (\Gamma \ (\mta{dispAlg}\ (X, x)) \to \mta{DispAlg}\ (X, x) \\
&\emb{(M, m)}^{\mta{dispAlg}} := (\mta{El}\ M@@, \emb{m}^{\mta{dispAlgebra}}) \,. \\[1em]
&\emb{\_}^{\mta{dispAlgebra}} : \Tms\ \Gamma \ (\mta{dispAlgebra}\ (X, x)\ M) \to \mta{DispAlgebra}\ (X, x)\ M \\
&\emb{\bullet}^{\mta{dispAlgebra}}\ \{T = \bullet\}\ (v, \_)\text{ impossible by $v : \mta{Var}\ \bullet$} \\
&\emb{(m', u)}^{\mta{dispAlgebra}}\ \{T = T' \rhd O\}\ (\mta{here}, d) := (u@)[\Msub{d}] \\
&\emb{(m', u)}^{\mta{dispAlgebra}}\ \{T = T' \rhd O\}\ (\mta{there}\ v, d) := \emb{m'}^{\mta{dispAlgebra}}\ (v, d) \,.
\end{align*}
\end{fleqn}

\subsubsection{Sections}

\begin{fleqn}
\begin{align*}
&\mta{sec} : \Ty\ (\Gamma \rhd \mta{alg}\ T \rhd \mta{dispAlg})  \\
&\mta{sec}\ \{P\} := X\ x\ M\ m.\ \Pi\ P\ \Pi\ X\ M \,. \\[1em]
&\mta{apply} : \mta{Tms}\ \Gamma\ (\mta{in}\ O\ X) \to \mta{Sec}\ M \to \Tms\ \Gamma\ (\mta{in}\ O\ (X, x)\ M) \\
&\mta{apply}\ \{O = \Pi\ A\ B\}\ (a, t)\ f := (a, \mta{apply}\ \{O = B[\Msub a]\}\ t\ f) \\
&\mta{apply}\ \{O = \Pi\iota\ p\ B\}\ (y, t)\ f := (y, f[\Msub y], \mta{apply}\ \{O = B\}\ t\ f) \\
&\mta{apply}\ \{O = \iota\ p\}\ (\,)\ f := (\,) \,. \\[1em]
&\mta{cohOpRet} : (v : \mta{Var}\ T) \to \Tms\ \Gamma\ (\mta{dispIn}\ (T v)\ (X, x)\ M) \\ &\qquad \to \mta{DispAlgebra}\ (X, x)\ M \to \mta{Sec}\ M \to \Ty\ \Gamma \\
&\mta{cohOpRet}\ v\ i\ m\ f := \text{let $a$ = $\mta{dispInIn}\ i$ in } \\ & \qquad \mta{Id}\ f[\Msub{\mta{dispOut}\ i\ (x\ (v, a))}]\ (m\ (v, \mta{apply}\ a\ f)) \\[1em]
&\mta{cohOp} : \mta{Var}\ T \to ((X, x) : \mta{Alg}\ T) \to ((M, m) : \mta{DispAlg}\ (X, x)) \to \mta{Sec}\ M \to \Ty\ \Gamma \\
&\mta{cohOp}\ v\ (X, x)\ (M, m)\ f := \\ & \qquad \Pi\ (a : \mta{dispIn}\ (T\ v)\ (X, x)\ M)\ (\mta{cohOpRet}\ v\ a\ \emb{(M, m)}^{\mta{dispAlg}}\ f)\, . \\[1em]
&\mta{coh} : ((X, x) : \mta{Alg}\ T) \to ((M, m) : \mta{DispAlg}\ (X, x)) \to \Tel\ (\Gamma \rhd \Pi\ P\ \Pi\ X\ M) \\
&\mta{coh}\ \{T = \bullet\}\ X\ M := \bullet \\
&\mta{coh}\ \{T = T' \rhd O\}\ (X, x, y)\ (M, m, n) := \\ & \qquad f.\ (\mta{coh}\ \{T'\}\ (X, x)\ (M, m))[\Msub{f}] \rhd \mta{cohOp}\ \mta{here}\ (X, y)\ (M, n)\ f \,. \\[1em]
&\mta{section} : \Tel\ (\Gamma \rhd \mta{alg}\ T \rhd \mta{dispAlg}) \\
&\mta{section} := X\ x\ M\ m.\ \mta{sec}\ X\ x\ M\ m \rhd \mta{coh}\ \emb{(X, x)}^{\mta{alg}}\ \emb{(M, m)}^{\mta{dispAlg}} \,.
\end{align*}
\end{fleqn}

\subsubsection{Realisation functions for sections and inductive algebras}

\begin{fleqn}
\begin{align*}
&\emb{\_}^{\mta{coh}} : \Tms\ \Gamma \ (\mta{coh}\ (X, x)\ (M, m))[\Msub f] \to \mta{IntCoh}\ f@@ \\
&\emb{\bullet}^{\mta{coh}}\ \{T = \bullet\}\ (v, \_)\text{ impossible by $v : \mta{Var}\ \bullet$} \\
&\emb{(c, u)}^{\mta{coh}}\ \{T = T' \rhd O\}\ (\mta{here}, d) := (u@)[\Msub{d}] \\
&\emb{(c, u)}^{\mta{coh}}\ \{T = T' \rhd O\}\ (\mta{there}\ v, d) := \emb{c}^{\mta{coh}}\ (v, d) \,. \\[1em]
&\emb{\_}^{\mta{section}} : \Tms\ \Gamma \ \mta{section}[\Msub{X, x, M, m}] \to (f : \mta{Sec}\ \emb{(M, m)}^{\mta{dispAlg}}) \times \mta{IntCoh}\ f \\
&\emb{(X, x, M, m, f, c)}^{\mta{dispAlg}} := (f@@, \emb{m}^{\mta{coh}}) \,. \\[1em]
&\emb{\_}^\mta{indAlgebra} : \mta{Tms}\ \Gamma\ (\Pi\ \mta{dispAlg}[\Msub X]\ \mta{section}[\Msub X]) \\ & \qquad \to (m : \mta{DispAlg}\ X) \to (f : \mta{Sec}\ m) \times  \mta{IntCoh}\ f \\
&\emb{l}^\mta{indAlgebra}\ (M, m) := \emb{l@(\lambda\ \lambda\ M)@m}^\mta{section}
\end{align*}
\end{fleqn}

\subsection{Utilities when working with representations} \label{app:reprs}

We define the action of \mta{repr} and \mta{unrepr} on the algebra constructions above.
We omit the definition of $\emb{\_}^{\mta{Unrepr}}$ as it mirrors $\emb{\_}^{\mta{Repr}}$.

\begin{fleqn}
\begin{align*}
&\_^{\mta{Repr}} : \Tms\ \Gamma\ (\mta{in}\ O\ X) \to \Tms\ \Gamma\ (\mta{in}\ O\ (\mta{Repr}\ X)) \\
&(a, t)^{\mta{Repr}}\ \{O = \Pi\ A\ B\} := (a, t^\mta{Repr}\ \{O = B[\Msub a]\}) \\
&(x, t)^{\mta{Repr}}\ \{O = \Pi\iota\ p\ B\} := (\mta{repr}\ a, t^\mta{Repr}\ \{O = B\}) \\
&(\,)^{\mta{Repr}}\ \{O = \iota\ p\} := (\,) \,. \\[1em]
&\_^{\mta{Repr}} : \Tms\ \Gamma\ (\mta{dispIn}\ O\ (X, x)\ M) \to \Tms\ \Gamma\ (\mta{dispIn}\ O\ (X, x)\ (\mta{Repr}\ M)) \\
&(a, t)^{\mta{Repr}}\ \{O = \Pi\ A\ B\} := (a, t^\mta{Repr}\ \{O = B[\Msub a]\}) \\
&(y, m, t)^{\mta{Repr}}\ \{O = \Pi\iota\ p\ B\} := (y, \mta{repr}\ m, t^\mta{Repr}\ \{O = B\}) \,. \\[1em]
&\_^{\mta{Repr}} : \mta{Algebra}\ T\ X \to \mta{Algebra}\ T\ (\mta{Repr}\ X) \\
&f^{\mta{Repr}}\ (v, d) := \mta{repr}\ (f\ (v, d^{\mta{Unrepr}})) \,. \\[1em]
&\_^{\mta{Repr}*} : \Tms\ \Gamma\ (\mta{dispIn}\ O\ (X, x)\ M) \\ & \qquad \to \Tms\ \Gamma\ (\mta{dispIn}\ O\ (X, x)^{\mta{Repr}}\ (p\ x .\ M[\Msub{p;\mta{unrepr}\ x}])) \\
&(a, t)^{\mta{Repr}*}\ \{O = \Pi\ A\ B\} := (a, t^{\mta{Repr}*}\ \{O = B[\Msub a]\}) \\
&(y, m, t)^{\mta{Repr}*}\ \{O = \Pi\iota\ p\ B\} := (\mta{repr}\ y, m, t^{\mta{Repr}*}\ \{O = B\}) \\
&(\,)^{\mta{Repr}*}\ \{O = \iota\ p\} := (\,) \,. \\[1em]
&\_^{\mta{Repr}} : \mta{DispAlgebra}\ (X, x)\ M \to \mta{DispAlgebra}\ (X, x)\ (\mta{Repr}\ M) \\
&f^{\mta{Repr}}\ (v, d) := \mta{repr}\ (f\ (v, d^{\mta{Unrepr}})) \,. \\[1em]
&\_^{\mta{Repr}*} : \mta{DispAlgebra}\ (X, x)\ M \to \mta{DispAlgebra}\ (X, x)^{\mta{Repr}}\ (p\ x .\ M[\Msub{p;\mta{unrepr}\ x}]) \\
&f^{\mta{Repr}}\ (v, d) := f\ (v, d^{\mta{Unrepr}}) \,.
\end{align*}
\end{fleqn}
